function cities(t){let a=$("[data-toggle=cities]");if(0==a.length)return!1;$.get(a.data("url")+"?country="+t,function(t){a.html(t)}).fail(function(){$.notify({message:lang.nodata},{type:"danger",placement:{from:"bottom",align:"right"}})})}function piechart(t,a){$.get(a,function(a){let e=[],o=[];for(var i in a.chart)e.push(i),o.push(a.chart[i]);if(window.datachart=new Chart(t,{type:"pie",data:{labels:e,datasets:[{data:o,borderWidth:5,backgroundColor:["#0F87FF","#0080C0","#80FFFF","#FF0000","#C0C0C0","#000000","#F1DF03","#d40000","#4D4D4D","#464646","#7A7A7A","#a4c639","#0080FF","#FF0080","#EEEEEE"]}]},options:{responsive:!window.MSInputMethodContext,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",display:!0}},cutoutPercentage:75}}),a.top){$("#top-"+t.data("type")).html("");for(const[e,o]of Object.entries(a.top))if("languages"==t.data("type"))$("#top-"+t.data("type")).append('<li class="d-block mb-2 w-100 border-bottom pb-2 fw-bold"><span class="align-middle">'+e+'</span> <small class="badge bg-dark text-white float-right float-end">'+o+"</small></li>");else{let a=appurl+"static/images/"+t.data("type")+"/"+e.split(" ")[0].toLowerCase()+".svg";"Unknown"==e.split(" ")[0]&&(a=appurl+"static/images/unknown.svg"),$("#top-"+t.data("type")).append('<li class="d-block mb-2 w-100 border-bottom pb-2 fw-bold"><img src="'+a+'" width="16" class="mr-1 me-1"> <span class="align-middle">'+e+'</span> <small class="badge bg-dark text-white float-right float-end">'+o+"</small></li>")}}}).fail(function(){$.notify({message:lang.nodata},{type:"danger",placement:{from:"bottom",align:"right"}})})}function charts(t,a){$.get(a,function(a){let e=[],o=[],i=t.get()[0].getContext("2d").createLinearGradient(0,0,0,225);for(var n in i.addColorStop(0,t.data("color-start")?t.data("color-start"):"rgba(0, 138, 255, 1)"),i.addColorStop(1,t.data("color-start")?t.data("color-stop"):"rgba(255,255,255,0)"),a.data)e.push(n),o.push(a.data[n]);window.clickchart=new Chart(t,{type:"line",data:{labels:e,datasets:[{label:a.label,fill:!0,tension:.3,backgroundColor:i,borderColor:t.data("color-start")?t.data("color-start"):"#008aff",data:o}]},options:{maintainAspectRatio:!1,legend:{display:!1},tooltips:{intersect:!1},hover:{intersect:!0},plugins:{filler:{propagate:!1},legend:{display:!1}},scales:{x:{grid:{display:!1},min:0},y:{grid:{display:!1},min:0}}}})}).fail(function(){$.notify({message:lang.nodata},{type:"danger",placement:{from:"bottom",align:"right"}})})}function maps(t,a){$.get(a,function(a){window.map=new jsVectorMap({map:"world",selector:"#"+t.attr("id"),zoomButtons:!0,visualizeData:{scale:["#D3EBFF","#008aff"],values:a.list},regionsSelectable:!0,regionsSelectableOne:!0,zoomOnScroll:!0,onRegionTooltipShow(t,e){t.text(t.text()+" ("+(void 0!==a.list[e]?a.list[e]:0)+")")},onRegionSelected(t){cities(t)}}),$("#top-countries").html("");for(const[t,e]of Object.entries(a.top)){let a=appurl+"static/images/flags/"+t.toLowerCase()+".svg";"Unknown"==e.name&&(a=appurl+"static/images/unknown.svg"),$("#top-countries").append('<li class="d-block mb-2 w-100 border-bottom pb-2 fw-bold"><img src="'+a+'" width="16" class="mr-1 me-1"><span class="align-middle">'+e.name+'</span> <small class="badge bg-dark text-white float-right float-end">'+e.count+"</small></li>")}if(void 0!==typeof a.cities&&a.cities){$("#top-cities").html("");for(const[t,e]of Object.entries(a.cities)){let t=appurl+"static/images/flags/"+e.country.toLowerCase()+".svg";"Unknown"==e.name&&(t=appurl+"static/images/unknown.svg"),$("#top-cities").append('<li class="d-block mb-2 w-100 border-bottom pb-2 fw-bold"><img src="'+t+'" width="16" class="mr-1 me-1"><span class="align-middle">'+e.name+'</span> <small class="badge bg-dark text-white float-right float-end">'+e.count+"</small></li>")}}window.addEventListener("resize",()=>{window.map.updateSize()})}).fail(function(){$.notify({message:lang.nodata},{type:"danger",placement:{from:"bottom",align:"right"}})})}$(document).ready(function(){$("[data-trigger=chart]").length>0&&($("[data-trigger=chart]").each(function(){charts($(this),$(this).data("url"))}),$("input[name=customreport]").on("apply.daterangepicker",function(t,a){void 0!==window.clickchart&&window.clickchart.destroy(),charts($("[data-trigger=chart"),$("[data-trigger=chart").data("url")+"?from="+a.startDate.format("MM/DD/YYYY")+"&to="+a.endDate.format("MM/DD/YYYY")),$(this).val(a.startDate.format("MM/DD/YYYY")+" - "+a.endDate.format("MM/DD/YYYY"))})),$("[data-trigger=dynamic-map]").length>0&&(maps($("[data-trigger=dynamic-map]"),$("[data-trigger=dynamic-map]").data("url")),$("input[name=customreport]").on("apply.daterangepicker",function(t,a){window.map.reset(),maps($("[data-trigger=dynamic-map]"),$("[data-trigger=dynamic-map]").data("url")+"?from="+a.startDate.format("MM/DD/YYYY")+"&to="+a.endDate.format("MM/DD/YYYY")),$(this).val(a.startDate.format("MM/DD/YYYY")+" - "+a.endDate.format("MM/DD/YYYY"))})),$("[data-trigger=dynamic-pie]").length>0&&($("[data-trigger=dynamic-pie]").each(function(){piechart($(this),$(this).data("url"))}),$("input[name=customreport]").on("apply.daterangepicker",function(t,a){void 0!==window.datachart&&window.datachart.destroy(),piechart($("[data-trigger=dynamic-pie]"),$("[data-trigger=dynamic-pie]").data("url")+"?from="+a.startDate.format("MM/DD/YYYY")+"&to="+a.endDate.format("MM/DD/YYYY")),$(this).val(a.startDate.format("MM/DD/YYYY")+" - "+a.endDate.format("MM/DD/YYYY"))}))});